#!/usr/bin/env coffee



minimist =		require 'minimist'
fs =			require 'fs'
argv = minimist process.argv.slice 2



help = [
	'Usage:'
	'vbb-rest -a <apiKey> -c <cert> -k <key> [-p <port>]'
	''
	'Arguments:'
	'  -a, --apiKey  The VBB API server API key.'
	'  -c, --cert    The SSL certificate.'
	'  -k, --key     The SSL key.'
	''
	'Options:'
	'  -p, --port    Where the server will listen. Default: 8000'
].join '\n'

if argv.h is true or argv.help is true
	process.stdout.write help
	process.exit 0



apiKey = null
if argv.a? then apiKey = argv.a
else if argv.apiKey? then apiKey = argv.apiKey
else throw new Error 'Missing `--apiKey` argument.'

cert = null
if argv.c? then cert = argv.c
else if argv.cert? then cert = argv.cert
else throw new Error 'Missing `--cert` argument.'
cert = fs.readFileSync cert

key = null
if argv.k? then key = argv.k
else if argv.key? then key = argv.key
else throw new Error 'Missing `--key` argument.'
key = fs.readFileSync key

port = 8000
if argv.p? then port = argv.p
if argv.port? then port = argv.port



Server =		require '../src/Server'
winston =		require 'winston'   # todo: consider using `bunyan`

server = Object.create Server
server.init apiKey, cert, key, port, winston
server.listen () ->
	winston.info "Server listening on #{port}."
